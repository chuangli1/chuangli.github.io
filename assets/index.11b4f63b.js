import{g as ie}from"./_commonjsHelpers.a5007c1f.js";import{F as le}from"./FileSaver.min.0a913109.js";import{_ as ce}from"./index.eef6619a.js";import{d as fe,h as W,r as pe,o as ue,a as de,b as k,j as X,e as te,q as me,F as he,J as ge,K as ve}from"./vendor.6f35fcad.js";var we={exports:{}};(function(o){var i=function(c){var u=Object.prototype,f=u.hasOwnProperty,l,v=typeof Symbol=="function"?Symbol:{},d=v.iterator||"@@iterator",w=v.asyncIterator||"@@asyncIterator",h=v.toStringTag||"@@toStringTag";function g(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{g({},"")}catch{g=function(e,r,a){return e[r]=a}}function C(t,e,r,a){var n=e&&e.prototype instanceof j?e:j,y=Object.create(n.prototype),F=new p(a||[]);return y._invoke=H(t,r,F),y}c.wrap=C;function $(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(a){return{type:"throw",arg:a}}}var P="suspendedStart",O="suspendedYield",I="executing",R="completed",L={};function j(){}function A(){}function T(){}var B={};g(B,d,function(){return this});var z=Object.getPrototypeOf,D=z&&z(z(m([])));D&&D!==u&&f.call(D,d)&&(B=D);var N=T.prototype=j.prototype=Object.create(B);A.prototype=T,g(N,"constructor",T),g(T,"constructor",A),A.displayName=g(T,h,"GeneratorFunction");function Y(t){["next","throw","return"].forEach(function(e){g(t,e,function(r){return this._invoke(e,r)})})}c.isGeneratorFunction=function(t){var e=typeof t=="function"&&t.constructor;return e?e===A||(e.displayName||e.name)==="GeneratorFunction":!1},c.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,T):(t.__proto__=T,g(t,h,"GeneratorFunction")),t.prototype=Object.create(N),t},c.awrap=function(t){return{__await:t}};function M(t,e){function r(y,F,E,S){var _=$(t[y],t,F);if(_.type==="throw")S(_.arg);else{var Q=_.arg,q=Q.value;return q&&typeof q=="object"&&f.call(q,"__await")?e.resolve(q.__await).then(function(G){r("next",G,E,S)},function(G){r("throw",G,E,S)}):e.resolve(q).then(function(G){Q.value=G,E(Q)},function(G){return r("throw",G,E,S)})}}var a;function n(y,F){function E(){return new e(function(S,_){r(y,F,S,_)})}return a=a?a.then(E,E):E()}this._invoke=n}Y(M.prototype),g(M.prototype,w,function(){return this}),c.AsyncIterator=M,c.async=function(t,e,r,a,n){n===void 0&&(n=Promise);var y=new M(C(t,e,r,a),n);return c.isGeneratorFunction(e)?y:y.next().then(function(F){return F.done?F.value:y.next()})};function H(t,e,r){var a=P;return function(y,F){if(a===I)throw new Error("Generator is already running");if(a===R){if(y==="throw")throw F;return b()}for(r.method=y,r.arg=F;;){var E=r.delegate;if(E){var S=K(E,r);if(S){if(S===L)continue;return S}}if(r.method==="next")r.sent=r._sent=r.arg;else if(r.method==="throw"){if(a===P)throw a=R,r.arg;r.dispatchException(r.arg)}else r.method==="return"&&r.abrupt("return",r.arg);a=I;var _=$(t,e,r);if(_.type==="normal"){if(a=r.done?R:O,_.arg===L)continue;return{value:_.arg,done:r.done}}else _.type==="throw"&&(a=R,r.method="throw",r.arg=_.arg)}}}function K(t,e){var r=t.iterator[e.method];if(r===l){if(e.delegate=null,e.method==="throw"){if(t.iterator.return&&(e.method="return",e.arg=l,K(t,e),e.method==="throw"))return L;e.method="throw",e.arg=new TypeError("The iterator does not provide a 'throw' method")}return L}var a=$(r,t.iterator,e.arg);if(a.type==="throw")return e.method="throw",e.arg=a.arg,e.delegate=null,L;var n=a.arg;if(!n)return e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,L;if(n.done)e[t.resultName]=n.value,e.next=t.nextLoc,e.method!=="return"&&(e.method="next",e.arg=l);else return n;return e.delegate=null,L}Y(N),g(N,h,"Generator"),g(N,d,function(){return this}),g(N,"toString",function(){return"[object Generator]"});function Z(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function s(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(Z,this),this.reset(!0)}c.keys=function(t){var e=[];for(var r in t)e.push(r);return e.reverse(),function a(){for(;e.length;){var n=e.pop();if(n in t)return a.value=n,a.done=!1,a}return a.done=!0,a}};function m(t){if(t){var e=t[d];if(e)return e.call(t);if(typeof t.next=="function")return t;if(!isNaN(t.length)){var r=-1,a=function n(){for(;++r<t.length;)if(f.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=l,n.done=!0,n};return a.next=a}}return{next:b}}c.values=m;function b(){return{value:l,done:!0}}return p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=l,this.done=!1,this.delegate=null,this.method="next",this.arg=l,this.tryEntries.forEach(s),!t)for(var e in this)e.charAt(0)==="t"&&f.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=l)},stop:function(){this.done=!0;var t=this.tryEntries[0],e=t.completion;if(e.type==="throw")throw e.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(S,_){return y.type="throw",y.arg=t,e.next=S,_&&(e.method="next",e.arg=l),!!_}for(var a=this.tryEntries.length-1;a>=0;--a){var n=this.tryEntries[a],y=n.completion;if(n.tryLoc==="root")return r("end");if(n.tryLoc<=this.prev){var F=f.call(n,"catchLoc"),E=f.call(n,"finallyLoc");if(F&&E){if(this.prev<n.catchLoc)return r(n.catchLoc,!0);if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else if(F){if(this.prev<n.catchLoc)return r(n.catchLoc,!0)}else if(E){if(this.prev<n.finallyLoc)return r(n.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&f.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var n=a;break}}n&&(t==="break"||t==="continue")&&n.tryLoc<=e&&e<=n.finallyLoc&&(n=null);var y=n?n.completion:{};return y.type=t,y.arg=e,n?(this.method="next",this.next=n.finallyLoc,L):this.complete(y)},complete:function(t,e){if(t.type==="throw")throw t.arg;return t.type==="break"||t.type==="continue"?this.next=t.arg:t.type==="return"?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):t.type==="normal"&&e&&(this.next=e),L},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),s(r),L}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var a=r.completion;if(a.type==="throw"){var n=a.arg;s(r)}return n}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:m(t),resultName:e,nextLoc:r},this.method==="next"&&(this.arg=l),L}},c}(o.exports);try{regeneratorRuntime=i}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}})(we);var ye={defaultArgs:["./ffmpeg","-nostdin","-y"],baseOptions:{log:!1,logger:()=>{},progress:()=>{},corePath:""}},be=(o,i)=>{const c=o._malloc(i.length*Uint32Array.BYTES_PER_ELEMENT);return i.forEach((u,f)=>{const l=o.lengthBytesUTF8(u)+1,v=o._malloc(l);o.stringToUTF8(u,v,l),o.setValue(c+Uint32Array.BYTES_PER_ELEMENT*f,v,"i32")}),[i.length,c]};const Fe="@ffmpeg/ffmpeg",Ee="0.11.5",_e="FFmpeg WebAssembly version",Le="src/index.js",je="src/index.d.ts",Se={example:"examples"},ke={start:"node scripts/server.js","start:worker":"node scripts/worker-server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js","build:worker":"rimraf dist && webpack --config scripts/webpack.config.worker.prod.js",prepublishOnly:"npm run build",lint:"eslint src",wait:"rimraf dist && wait-on http://localhost:3000/dist/ffmpeg.dev.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:ffmpeg test:node:all","test:node":"node node_modules/mocha/bin/_mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser":"mocha-headless-chrome -a allow-file-access-from-files -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:ffmpeg":"npm run test:browser -- -f ./tests/ffmpeg.test.html"},Pe={"./src/node/index.js":"./src/browser/index.js"},Ce={type:"git",url:"git+https://github.com/ffmpegwasm/ffmpeg.wasm.git"},$e=["ffmpeg","WebAssembly","video"],Oe="Jerome Wu <jeromewus@gmail.com>",Re="MIT",Te={url:"https://github.com/ffmpegwasm/ffmpeg.wasm/issues"},Ne={node:">=12.16.1"},Ae="https://github.com/ffmpegwasm/ffmpeg.wasm#readme",Ge={"is-url":"^1.2.4","node-fetch":"^2.6.1","regenerator-runtime":"^0.13.7","resolve-url":"^0.2.1"},Ue={"@babel/core":"^7.12.3","@babel/preset-env":"^7.12.1","@ffmpeg/core":"^0.11.0","@types/emscripten":"^1.39.4","babel-eslint":"^10.1.0","babel-loader":"^8.1.0",chai:"^4.2.0",cors:"^2.8.5",eslint:"^7.12.1","eslint-config-airbnb-base":"^14.1.0","eslint-plugin-import":"^2.22.1",express:"^4.17.1",mocha:"^8.2.1","mocha-headless-chrome":"^2.0.3","npm-run-all":"^4.1.5","wait-on":"^5.3.0",webpack:"^5.3.2","webpack-cli":"^4.1.0","webpack-dev-middleware":"^4.0.0"};var ne={name:Fe,version:Ee,description:_e,main:Le,types:je,directories:Se,scripts:ke,browser:Pe,repository:Ce,keywords:$e,author:Oe,license:Re,bugs:Te,engines:Ne,homepage:Ae,dependencies:Ge,devDependencies:Ue};const Ie=(typeof process<"u",`https://unpkg.com/@ffmpeg/core@${ne.devDependencies["@ffmpeg/core"].substring(1)}/dist/ffmpeg-core.js`);var Be={corePath:Ie};let ee=!1,ae=()=>{};const De=o=>{ee=o},Me=o=>{ae=o},We=(o,i)=>{ae({type:o,message:i}),ee&&console.log(`[${o}] ${i}`)};var U={logging:ee,setLogging:De,setCustomLogger:Me,log:We};const Ve=o=>`
createFFmpegCore is not defined. ffmpeg.wasm is unable to find createFFmpegCore after loading ffmpeg-core.js from ${o}. Use another URL when calling createFFmpeg():

const ffmpeg = createFFmpeg({
  corePath: 'http://localhost:3000/ffmpeg-core.js',
});
`;var re={CREATE_FFMPEG_CORE_IS_NOT_DEFINED:Ve};const V=async(o,i)=>{U.log("info",`fetch ${o}`);const c=await(await fetch(o)).arrayBuffer();U.log("info",`${o} file size = ${c.byteLength} bytes`);const u=new Blob([c],{type:i}),f=URL.createObjectURL(u);return U.log("info",`${o} blob URL = ${f}`),f},ze=async({corePath:o,workerPath:i,wasmPath:c})=>{if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope){if(typeof o!="string")throw Error("corePath should be a string!");const d=new URL(o,import.meta.url).href,w=await V(d,"application/javascript"),h=await V(c!==void 0?c:d.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),g=await V(i!==void 0?i:d.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(C=>{if(globalThis.importScripts(w),typeof createFFmpegCore>"u")throw Error(re.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(d));U.log("info","ffmpeg-core.js script loaded"),C({createFFmpegCore,corePath:w,wasmPath:h,workerPath:g})}):(U.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:w,wasmPath:h,workerPath:g}))}if(typeof o!="string")throw Error("corePath should be a string!");const u=new URL(o,import.meta.url).href,f=await V(u,"application/javascript"),l=await V(u.replace("ffmpeg-core.js","ffmpeg-core.wasm"),"application/wasm"),v=await V(u.replace("ffmpeg-core.js","ffmpeg-core.worker.js"),"application/javascript");return typeof createFFmpegCore>"u"?new Promise(d=>{const w=document.createElement("script"),h=()=>{if(w.removeEventListener("load",h),typeof createFFmpegCore>"u")throw Error(re.CREATE_FFMPEG_CORE_IS_NOT_DEFINED(u));U.log("info","ffmpeg-core.js script loaded"),d({createFFmpegCore,corePath:f,wasmPath:l,workerPath:v})};w.src=f,w.type="text/javascript",w.addEventListener("load",h),document.getElementsByTagName("head")[0].appendChild(w)}):(U.log("info","ffmpeg-core.js script is loaded already"),Promise.resolve({createFFmpegCore,corePath:f,wasmPath:l,workerPath:v}))},qe=o=>new Promise((i,c)=>{const u=new FileReader;u.onload=()=>{i(u.result)},u.onerror=({target:{error:{code:f}}})=>{c(Error(`File could not be read! Code=${f}`))},u.readAsArrayBuffer(o)}),Ye=async o=>{let i=o;return typeof o>"u"?new Uint8Array:(typeof o=="string"?/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(o)?i=atob(o.split(",")[1]).split("").map(c=>c.charCodeAt(0)):i=await(await fetch(new URL(o,import.meta.url).href)).arrayBuffer():(o instanceof File||o instanceof Blob)&&(i=await qe(o)),new Uint8Array(i))};var Ke=Object.freeze(Object.defineProperty({__proto__:null,defaultOptions:Be,getCreateFFmpegCore:ze,fetchFile:Ye},Symbol.toStringTag,{value:"Module"})),se=ie(Ke);const{defaultArgs:Je,baseOptions:He}=ye,Ze=be,{defaultOptions:Qe,getCreateFFmpegCore:Xe}=se,{version:xe}=ne,x=Error("ffmpeg.wasm is not ready, make sure you have completed load().");var et=(o={})=>{const{log:i,logger:c,progress:u,...f}={...He,...Qe,...o};let l=null,v=null,d=null,w=null,h=!1,g=()=>{},C=i,$=u,P=0,O=0,I=!1,R=0;const L=s=>{s==="FFMPEG_END"&&d!==null&&(d(),d=null,w=null,h=!1)},j=(s,p)=>{g({type:s,message:p}),C&&console.log(`[${s}] ${p}`)},A=s=>{const[p,m,b]=s.split(":");return parseFloat(p)*60*60+parseFloat(m)*60+parseFloat(b)},T=(s,p)=>{if(typeof s=="string")if(s.startsWith("  Duration")){const m=s.split(", ")[0].split(": ")[1],b=A(m);p({duration:b,ratio:R}),(P===0||P>b)&&(P=b,I=!0)}else if(I&&s.startsWith("    Stream")){const m=s.match(/([\d.]+) fps/);if(m){const b=parseFloat(m[1]);O=P*b}else O=0;I=!1}else if(s.startsWith("frame")||s.startsWith("size")){const m=s.split("time=")[1].split(" ")[0],b=A(m),t=s.match(/frame=\s*(\d+)/);if(O&&t){const e=parseFloat(t[1]);R=Math.min(e/O,1)}else R=b/P;p({ratio:R,time:b})}else s.startsWith("video:")&&(p({ratio:1}),P=0)},B=({type:s,message:p})=>{j(s,p),T(p,$),L(p)},z=async()=>{if(j("info","load ffmpeg-core"),l===null){j("info","loading ffmpeg-core");const{createFFmpegCore:s,corePath:p,workerPath:m,wasmPath:b}=await Xe(f);l=await s({mainScriptUrlOrBlob:p,printErr:t=>B({type:"fferr",message:t}),print:t=>B({type:"ffout",message:t}),locateFile:(t,e)=>{if(typeof window<"u"||typeof WorkerGlobalScope<"u"){if(typeof b<"u"&&t.endsWith("ffmpeg-core.wasm"))return b;if(typeof m<"u"&&t.endsWith("ffmpeg-core.worker.js"))return m}return e+t}}),v=l.cwrap(f.mainName||"proxy_main","number",["number","number"]),j("info","ffmpeg-core loaded")}else throw Error("ffmpeg.wasm was loaded, you should not load it again, use ffmpeg.isLoaded() to check next time.")},D=()=>l!==null,N=(...s)=>{if(j("info",`run ffmpeg command: ${s.join(" ")}`),l===null)throw x;if(h)throw Error("ffmpeg.wasm can only run one command at a time");return h=!0,new Promise((p,m)=>{const b=[...Je,...s].filter(t=>t.length!==0);d=p,w=m,v(...Ze(l,b))})},Y=(s,...p)=>{if(j("info",`run FS.${s} ${p.map(m=>typeof m=="string"?m:`<${m.length} bytes binary file>`).join(" ")}`),l===null)throw x;{let m=null;try{m=l.FS[s](...p)}catch{throw Error(s==="readdir"?`ffmpeg.FS('readdir', '${p[0]}') error. Check if the path exists, ex: ffmpeg.FS('readdir', '/')`:s==="readFile"?`ffmpeg.FS('readFile', '${p[0]}') error. Check if the path exists`:"Oops, something went wrong in FS operation.")}return m}},M=()=>{if(l===null)throw x;w&&w("ffmpeg has exited"),h=!1;try{l.exit(1)}catch(s){j(s.message),w&&w(s)}finally{l=null,v=null,d=null,w=null}},H=s=>{$=s},K=s=>{g=s},Z=s=>{C=s};return j("info",`use ffmpeg.wasm v${xe}`),{setProgress:H,setLogger:K,setLogging:Z,load:z,isLoaded:D,run:N,exit:M,FS:Y}};const tt=et,{fetchFile:rt}=se;var oe={createFFmpeg:tt,fetchFile:rt};const ot=fe({setup(){const o=oe.createFFmpeg({log:!0,corePath:"/ffmpeg-core.js",progress:h=>{v.value=(Math.floor(Number(h.ratio*1e4)*100)/1e4).toFixed(2)+"%"}}),i=W("\u9009\u62E9\u6587\u4EF6\uFF0C\u5F00\u59CB\u8F6C\u6362");let c=W(null);const u=W(null),f=W(null),l=W(!1),v=W("0%");async function d(h,g){i.value="\u8F7D\u5165\u8F6C\u6362\u6587\u4EF6\u4E2D,\u53EF\u80FD\u9700\u8981\u82B1\u8D39\u51E0\u5206\u949F...",o.isLoaded()||await o.load(),i.value="\u8F6C\u6362\u4E2D...",o.FS("writeFile",h.name,await oe.fetchFile(h.file));const C=h.name.split(".");C.pop();const $=C.join(".")+g;o.setLogging(!1),await o.run("-i",h.name,"-threads","10","-preset","ultrafast","-c:v","libx264",$),i.value="\u5B8C\u6210\u8F6C\u6362\uFF01";const P=o.FS("readFile",$),O=new Blob([P.buffer]);window.URL.createObjectURL(O),le.exports.saveAs(O,$),l.value=!1,v.value="0%",i.value="\u4E0B\u8F7D\u6587\u4EF6\u4E2D..."}return{video:c,message:i,transcode:d,startChange:()=>{if(u.value.length&&f.value){const h=u.value[0],g=f.value;d(h,g),l.value=!0}else i.value="\u8BF7\u4E0A\u4F20\u6587\u4EF6\u6216\u8005\u9009\u62E9\u8981\u8F6C\u6362\u7684\u7C7B\u578B"},format:f,file:u,start:l,progress:v}}}),J=o=>(ge("data-v-7cdfa042"),o=o(),ve(),o),nt={class:"v2v"},at={class:"step"},st=J(()=>k("div",{class:"mb5"},"\u7B2C\u4E00\u6B65\uFF1A\u4E0A\u4F20\u89C6\u9891\u6587\u4EF6",-1)),it={class:"step"},lt=J(()=>k("div",{class:"mb5"},"\u7B2C\u4E8C\u6B65\uFF1A\u9009\u62E9\u8F6C\u6362\u683C\u5F0F",-1)),ct={class:"step"},ft=J(()=>k("span",null,null,-1)),pt={class:"center"},ut={class:"bar-outer"},dt={class:"center"},mt=J(()=>k("div",{class:"w80"},null,-1));function ht(o,i,c,u,f,l){const v=pe("FormKit");return ue(),de(he,null,[k("div",nt,[k("div",at,[st,X(v,{type:"file",accept:".mp4,.flv,.mkv,.avi",modelValue:o.file,"onUpdate:modelValue":i[0]||(i[0]=d=>o.file=d),disabled:o.start},null,8,["modelValue","disabled"])]),k("div",it,[lt,X(v,{type:"select",placeholder:"\u8BF7\u9009\u62E9\u8981\u8F6C\u6362\u7684\u683C\u5F0F",name:"planet",modelValue:o.format,"onUpdate:modelValue":i[1]||(i[1]=d=>o.format=d),disabled:o.start,options:[{label:"mp4",value:".mp4"},{label:"flv",value:".flv"},{label:"avi",value:".avi"},{label:"mkv",value:".mkv"}]},null,8,["modelValue","disabled","options"])]),k("div",ct,[ft,X(v,{type:"button",label:"\u5F00\u59CB\u8F6C\u6362",onClick:o.startChange,disabled:o.start},null,8,["onClick","disabled"])])]),k("p",pt,te(o.message),1),k("div",ut,[k("div",{class:"bar-inner",style:me(`width: ${o.progress}`)},null,4)]),k("div",dt,te(o.progress),1),mt],64)}var bt=ce(ot,[["render",ht],["__scopeId","data-v-7cdfa042"]]);export{bt as default};
